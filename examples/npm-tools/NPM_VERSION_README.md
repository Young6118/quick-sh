# NPM版本管理工具

一个强大的NPM包版本管理工具，支持自动化版本更新、生成changelog、创建Git标签等功能。

## 功能特性

- 🚀 **智能版本更新**: 支持patch、minor、major版本类型
- 📝 **自动生成Changelog**: 基于Git提交历史自动生成更新日志
- 🏷️ **Git标签管理**: 自动创建带详细信息的Git标签
- 📦 **包文件同步**: 同时更新package.json和package-lock.json
- 🔄 **交互式界面**: 友好的命令行交互体验
- 📊 **版本历史**: 查看项目版本发布历史
- 🔍 **提交跟踪**: 显示未发布的提交列表

## 安装使用

### 1. 设置脚本路径
```bash
q -path examples
```

### 2. 启动NPM版本管理工具
```bash
q npm-version
```

## 使用指南

### 主界面功能

启动工具后，会显示：
- 📋 项目信息 (项目名称、当前版本、最新标签等)
- 📋 可用操作菜单

### 操作菜单

#### [1] 更新包版本
主要功能，包含完整的版本发布流程：

1. **选择版本类型**:
   - `patch` - 补丁版本 (修复bug) - 例: 1.0.0 → 1.0.1
   - `minor` - 次要版本 (新功能) - 例: 1.0.0 → 1.1.0  
   - `major` - 主要版本 (破坏性变更) - 例: 1.0.0 → 2.0.0

2. **版本更新确认**:
   - 显示当前版本和新版本
   - 展示将要包含的提交列表
   - 确认是否继续更新

3. **自动化执行**:
   - 更新package.json版本号
   - 更新package-lock.json版本号
   - 生成/更新CHANGELOG.md
   - 提交版本更改
   - 创建Git标签
   - 可选推送到远程仓库

#### [2] 查看版本历史
显示项目的版本发布历史，包括：
- 版本标签列表
- 发布日期和作者信息
- 按时间倒序显示最近10个版本

#### [3] 查看未发布提交
显示自上个版本以来的所有提交：
- 提交哈希和消息
- 提交作者和日期
- 未发布提交总数

#### [4] 刷新显示
重新加载项目信息和状态

#### [0] 退出
退出工具

## 生成的文件

### CHANGELOG.md
自动生成的更新日志格式：

```markdown
## [1.1.0] - 2024-01-15

### 更新内容

- feat: 添加新的功能模块 (abc123)
- fix: 修复登录bug (def456)
- docs: 更新README文档 (ghi789)

### 详细信息
- **更新人**: 张三
- **更新时间**: 2024-01-15
- **提交数量**: 3
- **提交范围**: ghi789..abc123

---
```

### Git标签
创建的标签包含详细提交信息：

```
Release v1.1.0

更新内容:
- feat: 添加新的功能模块 (abc123)
- fix: 修复登录bug (def456)  
- docs: 更新README文档 (ghi789)
```

## 使用场景

### 发布新功能版本
```bash
q npm-version
# 选择 [1] 更新包版本
# 选择 [2] minor - 次要版本 (新功能)
# 确认版本更新: y
# 推送到远程: y
```

### 发布bug修复版本
```bash
q npm-version
# 选择 [1] 更新包版本
# 选择 [1] patch - 补丁版本 (修复bug)
# 确认版本更新: y
# 推送到远程: y
```

### 查看项目状态
```bash
q npm-version
# 选择 [3] 查看未发布提交
# 查看有多少提交待发布
```

## 示例输出

```
📦 NPM 版本管理工具
====================

📋 项目信息:
   项目名称: quick-sh
   当前版本: 1.0.1
   工作目录: /path/to/project
   最新标签: v1.0.0
   未发布提交: 5 个

📋 可用操作:
   [1] 更新包版本
   [2] 查看版本历史
   [3] 查看未发布提交
   [4] 刷新显示
   [0] 退出

请选择操作 (0-4): 1

📦 选择版本更新类型:
当前版本: 1.0.1

   [1] patch - 补丁版本 (修复bug)
       1.0.0 → 1.0.1 (新版本: 1.0.2)
   [2] minor - 次要版本 (新功能)
       1.0.0 → 1.1.0 (新版本: 1.1.0)
   [3] major - 主要版本 (破坏性变更)
       1.0.0 → 2.0.0 (新版本: 2.0.0)

请选择版本类型 (1-3): 2

📋 版本更新确认:
   当前版本: 1.0.1
   新版本:   1.1.0
   更新类型: minor
   变更数量: 5 个提交

最近的提交:
   • feat: 添加Git账号管理功能 (abc123)
   • fix: 修复测试超时问题 (def456)
   • docs: 更新文档 (ghi789)
   • test: 添加新测试用例 (jkl012)
   • refactor: 重构配置管理 (mno345)

确认进行版本更新? (y/N): y

🚀 开始版本更新...
✅ 已更新 package.json 版本为 1.1.0
✅ 已更新 package-lock.json 版本为 1.1.0
✅ 已更新 /path/to/project/CHANGELOG.md
✅ 已提交版本更改
✅ 已创建 Git tag: v1.1.0

🎉 版本更新完成!
   新版本: 1.1.0
   Git tag: v1.1.0
   变更文件: package.json, package-lock.json, CHANGELOG.md

是否推送到远程仓库? (y/N): y
✅ 已推送到远程仓库
```

## 环境要求

### 必需条件
1. **Git仓库**: 项目必须在Git仓库中
2. **package.json**: 项目根目录必须有package.json文件
3. **Node.js**: 需要Node.js 14+环境
4. **Git配置**: 需要配置git用户名和邮箱

### 可选条件
- **package-lock.json**: 如果存在会自动更新版本
- **远程仓库**: 可选推送标签到远程仓库

## 工作流程

### 完整的版本发布流程
1. **环境检查**: 检查Git仓库和package.json
2. **状态检查**: 提醒未提交的更改
3. **版本计算**: 根据选择计算新版本号
4. **提交分析**: 分析自上个版本以来的提交
5. **用户确认**: 显示详细信息供用户确认
6. **文件更新**: 更新package.json和package-lock.json
7. **日志生成**: 生成/更新CHANGELOG.md
8. **提交更改**: 提交版本相关文件
9. **创建标签**: 创建带详细信息的Git标签
10. **推送发布**: 可选推送到远程仓库

## 注意事项

### 使用前准备
1. **提交更改**: 建议在版本发布前提交所有更改
2. **备份项目**: 重要项目建议先备份
3. **测试完成**: 确保所有功能测试通过

### 版本规范
- 遵循语义化版本规范 (Semantic Versioning)
- patch: 向后兼容的bug修复
- minor: 向后兼容的新功能
- major: 不向后兼容的重大更改

### Git操作
- 所有版本更改会自动提交
- 标签包含完整的提交信息
- 可选择推送到远程仓库

## 常见问题

### Q: 如何回滚版本？
A: 可以使用Git命令回滚：
```bash
git reset --hard HEAD~1  # 回滚提交
git tag -d v1.1.0        # 删除标签
```

### Q: CHANGELOG.md格式可以自定义吗？
A: 当前使用固定格式，可以手动编辑生成的文件

### Q: 支持预发布版本吗？
A: 当前版本不支持，未来版本会添加alpha、beta等支持

### Q: 如何只更新版本不创建标签？
A: 当前工具会自动创建标签，如需要可以手动删除标签

## 相关工具

- `q commit`: 交互式Git提交工具
- `q git-account`: Git账号管理工具
- `q setup-hooks`: Git hooks设置工具

## 技术实现

- **Node.js**: 核心运行环境
- **child_process**: 执行Git和npm命令
- **fs-extra**: 文件系统操作
- **readline**: 交互式命令行输入
- **语义化版本**: 标准版本号管理

---

更多信息请参考 [Quick Sh 文档](../README.md) 